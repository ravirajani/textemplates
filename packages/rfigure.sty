\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{rfigure}
\RequirePackage{newfloat}
\RequirePackage{float}
\RequirePackage{caption}
\RequirePackage{subcaption}
\RequirePackage{kvoptions}

\SetupKeyvalOptions{
    family=RF,
    prefix=RF@
}

\DeclareStringOption[1.5ex plus 1.5ex minus .3ex]{labelsep}
\DeclareStringOption[section]{numberwithin}

\ProcessKeyvalOptions*

\newlength{\RF@customheadsep}
\setlength{\RF@customheadsep}{\RF@labelsep}

\DeclareCaptionLabelSeparator{capspace}{\hspace{\RF@customheadsep}}
\DeclareCaptionLabelSeparator{subcapspace}{\enspace}

\captionsetup{labelfont=bf,labelsep=capspace}
\captionsetup[ruled]{labelsep=capspace}
\subcaptionsetup{labelformat=parens,labelfont=normalfont,labelsep=subcapspace,justification=raggedright}

\DeclareFloatingEnvironment[
    fileext=lof,
    listname={List of Figures},
    name=Figure,
    placement=htbp,
    within=\RF@numberwithin,
]{rfigure}
\DeclareCaptionSubType[alph]{rfigure}

\DeclareFloatingEnvironment[
    fileext=lot,
    listname={List of Tables},
    name=Table,
    placement=htbp,
    within=\RF@numberwithin,
]{rtable}
\captionsetup[rtable]{font=normalsize,justification=raggedright,singlelinecheck=false,skip=2pt}
\DeclareCaptionSubType[alph]{rtable}

\DeclareFloatingEnvironment[
    fileext=lot,
    listname={List of Algorithms},
    name=Algorithm,
    placement=htbp,
    within=\RF@numberwithin,
]{ralgorithm}
\floatstyle{ruled}
\restylefloat{ralgorithm}

\newenvironment{algorithm}[1][htbp]{\begin{ralgorithm}[#1]}{\end{ralgorithm}}
\renewenvironment{figure}[1][htbp]{\begin{rfigure}[#1]}{\end{rfigure}}
\renewenvironment{table}[1][htbp]{\begin{rtable}[#1]}{\end{rtable}}